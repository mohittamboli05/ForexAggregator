@model ForexAggregator.Web.Models.Provider
@{
    ViewData["Title"] = "Provider History";
}
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        var dataPoints = [];
        var chart = new CanvasJS.Chart("chartContainer", {
            animationEnabled: true,
            theme: "dark1", // "light1", "light2", "dark1", "dark2"
            exportEnabled: true,
            title: {
                text: $('#hdnSourceCurrency').val() + " Stock Price"
            },
            subtitles: [{
                text: "Monthly Averages"
            }],
            axisX: {
                interval: 1,
                valueFormatString: "MMM"
            },
            axisY: {
                prefix: $('#hdnSourceCurrency').val(),
                title: "Price"
            },
            toolTip: {
                content: "Date: {x}<br /><strong>Price:</strong><br />Open: {y[0]}, Close: {y[3]}<br />High: {y[1]}, Low: {y[2]}"
            },
            data: [{
                type: "candlestick",
                yValueFormatString: $('#hdnSourceCurrency').val() + " ##0.00",
                dataPoints: dataPoints
            }]
        });

        $.ajax({
            url: '/Home/GetHistory?sourceCurrency=' + $('#hdnSourceCurrency').val() + '&targetCurrency=' + $('#hdnTargetCurrency').val(),
            type: 'get',
            success: function (data) {
                console.log(data);
                $.each(data, function (index, value) {
                    dataPoints.push({
                        x: new Date(
                            value.tm.split("T")[0]
                            //parseInt(value.tm.split("T")[0].split("-")[0]),
                            //parseInt(value.tm.split("T")[0].split("-")[1]),
                            //parseInt(value.tm.split("T")[0].split("-")[2])
                        ),
                        y: [
                            parseFloat(value.o),
                            parseFloat(value.c),
                            parseFloat(value.h),
                            parseFloat(value.l)
                        ]
                    });
                });
                console.log(dataPoints);
                chart.render();

            }
        });
    });
</script>

<div class="container text-center">
    <h1>Provider History</h1>
    <div style="padding:10px; border: 1px solid gray; border-radius: 10px;">

        <table>
            <tr>
                <td class="float-left">Provider Name:</td>
                <td class="float-left">@Model.ProviderName</td>
            </tr>
            <tr>
                <td class="float-left">Address:</td>
                <td class="float-left">@Model.Location.Address @Model.Location.CityName</td>
            </tr>
        </table>
    </div>
    <br />
    <div id="chartContainer" style="height: 300px; width: 100%;"></div>
    <br />
    <div class="container">
        <div class="row">
            <div style="margin: 25px auto;">
                <h1 style="text-align: center">Enter Amount Below</h1>
                <form class="form-horizontal" method="post" asp-action="ProviderDetails">
                    @Html.HiddenFor(x => x.SourceCurrency, new { id = "hdnSourceCurrency" })
                    @Html.HiddenFor(x => x.TargetCurrency, new { id = "hdnTargetCurrency" })
                    @Html.HiddenFor(x => x.Location)
                    @Html.HiddenFor(x => x.ProviderId)
                    @Html.HiddenFor(x => x.ProviderName)
                    <div class="form-group">
                        <label class="control-label float-left" for="email">Enter Amount :</label>
                        <div class="">
                            @Html.TextBoxFor(m => m.Amount, new { @class = "form-control border-left", @numeric = "numeric", @placeholder = "" })
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 ">
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>