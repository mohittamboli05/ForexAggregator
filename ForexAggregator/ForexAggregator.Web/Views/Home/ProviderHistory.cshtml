@model ForexAggregator.Web.Models.ExchangeRateHistory
@{
    ViewData["Title"] = "Provider History";
}
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        var dataPoints = [];
        var chart = new CanvasJS.Chart("chartContainer", {
            animationEnabled: true,
            theme: "dark1", // "light1", "light2", "dark1", "dark2"
            exportEnabled: true,
            title: {
                text: $('#hdnSourceCurrency').val()+" Stock Price"
            },
            subtitles: [{
                text: "Monthly Averages"
            }],
            axisX: {
                interval: 1,
                valueFormatString: "MMM"
            },
            axisY: {
                prefix: $('#hdnSourceCurrency').val(),
                title: "Price"
            },
            toolTip: {
                content: "Date: {x}<br /><strong>Price:</strong><br />Open: {y[0]}, Close: {y[3]}<br />High: {y[1]}, Low: {y[2]}"
            },
            data: [{
                type: "candlestick",
                yValueFormatString: "$##0.00",
                dataPoints: dataPoints
            }]
        });

        $.ajax({
            url: '/Home/GetHistory?sourceCurrency=' + $('#hdnSourceCurrency').val() + '&targetCurrency=' + $('#hdnTargetCurrency').val(),
            type: 'get',
            success: function (data) {
                
                $.each(data, function (index, value) {
                    dataPoints.push({
                        x: new Date(
                            parseInt(value.tm.split(" ")[0].split("-")[0]),
                            parseInt(value.tm.split(" ")[0].split("-")[1]),
                            parseInt(value.tm.split(" ")[0].split("-")[2])
                        ),
                        y: [
                            parseFloat(value.o),
                            parseFloat(value.c),
                            parseFloat(value.h),
                            parseFloat(value.l)
                        ]
                    });
                });
                chart.render();

            }
        });
    });
</script>
@Html.HiddenFor(x => x.Source, new { id = "hdnSourceCurrency" })
@Html.HiddenFor(x => x.Target, new { id = "hdnTargetCurrency" })
<div class="container text-center">
    <h1>Provider History</h1>
    <div style="padding:10px; border: 1px solid gray; border-radius: 10px;">

        <table>
            <tr>
                <td class="float-left">Provider Name:</td>
                <td class="float-left">@Model.Provider.ProviderName</td>
            </tr>
            <tr>
                <td class="float-left">Address:</td>
                <td class="float-left">@Model.Provider.Location.Address @Model.Provider.Location.CityName</td>
            </tr>
        </table>
    </div>
    <div id="chartContainer" style="height: 300px; width: 100%;"></div>
</div>